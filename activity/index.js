/*
  Map size: 32 x 32
  Ghosts: {
    Total: 8
    Health: (Randomize but from lowest to highest)

    Notes: {
      Lowest ghost can't have higher health than pacman
    }
  }
  Pacman: {
    Health: (Randomize but can't be lower than lowest)
    Power: ???
  }
*/

// Game
var mapSize = 24;
var mapGame = document.getElementById("map");

// Game Labels
var healthLabel = document.getElementById("health");
var eatenLabel = document.getElementById("ghostEaten");
var nextLabel = document.getElementById("nextToEat");

// Ghosts
var ghosts = [];

// Pacman Character
var pacman = {
  health: 15,
  noOfEaten: 0,
  toEat: 0,
};
var [pacmanX, pacmanY] = [0, 0];
var [minX, maxX] = [0, mapSize - 1];
var [minY, maxY] = [0, mapSize - 1];

// Pacman Game
function setMap() {
  var tableMap = "";
  var perLine = "";

  // Drawing of map
  for (let x = 0; x < mapSize; x++) {
    perLine += "<tr>";

    for (let y = 0; y < mapSize; y++) {
      perLine += `<td></td>`;
    }

    perLine += "</tr>";
  }

  tableMap += perLine;
  mapGame.innerHTML = tableMap;

  setGhosts();
}
function setGhosts() {
  let [min, max] = [1, mapSize - 1];

  for (let ghost = 0; ghost < 24 / 4; ghost++) {
    // Randomize position
    let row = Math.floor(Math.random() * (max - min + 1) + min);
    let col = Math.floor(Math.random() * (max - min + 1) + min);
    let randomColor = getRandomColor();

    // Save ghost info
    ghosts.push({
      id: ghost + 1,
      isAlive: true,
      color: randomColor,
      health: (ghost + 1) * 10,
      x: col,
      y: row,
    });

    // Plot ghost to table
    mapGame.rows[row].cells[
      col
    ].innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="16" height="16" viewBox="0 0 512 512">${ghostBody(
      randomColor
    )}${ghostLeftEye(randomColor)}${ghostRightEye(randomColor)}</svg>`;
  }

  console.log(ghosts);
  mapGame.rows[0].cells[0].innerHTML = pacmanBody();
}
document.addEventListener("keyup", (event) => {
  mapGame.rows[pacmanY].cells[pacmanX].innerHTML = "";

  if (event.code === "ArrowUp") {
    pacmanY += pacmanY === minY ? mapSize - 1 : -1;
  } else if (event.code === "ArrowDown") {
    pacmanY += pacmanY === maxY ? -(mapSize - 1) : 1;
  } else if (event.code === "ArrowLeft") {
    pacmanX += pacmanX === minX ? mapSize - 1 : -1;
  } else if (event.code === "ArrowRight") {
    pacmanX += pacmanX === maxX ? -(mapSize - 1) : 1;
  }

  mapGame.rows[pacmanY].cells[pacmanX].innerHTML = pacmanBody();

  for (const ghost of ghosts) {
    if (ghost.x === pacmanX && ghost.y === pacmanY && ghost.isAlive) {
      if (pacman.health > ghost.health) {
        ghost.isAlive = false;
        pacman.health += 10;
        pacman.noOfEaten++;
        pacman.toEat = ghost.id;
      } else {
        alert("You lose!");

        window.location.reload();
      }
    }
  }

  // Update health & eaten
  healthLabel.innerHTML = pacman.health;
  eatenLabel.innerHTML = pacman.noOfEaten;
  nextLabel.innerHTML = ``;

  if (pacman.toEat === ghosts.length) {
    alert("You win!");

    // Update next to eat
  } else {
    // Update next to eat
    nextLabel.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="16" height="16" viewBox="0 0 512 512">${ghostBody(
      ghosts[pacman.toEat].color
    )}${ghostLeftEye(ghosts[pacman.toEat].color)}${ghostRightEye(
      ghosts[pacman.toEat].color
    )}</svg>`;
  }
});

// SVG Characters
function ghostBody(color) {
  return `<path xmlns="http://www.w3.org/2000/svg" d="M0 0 C0.74507813 0.63421875 1.49015625 1.2684375 2.2578125 1.921875 C15.76600887 13.73582302 28.42122226 26.48966209 39 41 C39.84447783 42.12673271 40.68953421 43.25303203 41.53515625 44.37890625 C66.41954537 77.92540078 81.95048001 118.0101871 87.75 159.25 C87.86561279 160.06315674 87.98122559 160.87631348 88.1003418 161.71411133 C90.25869884 178.42212202 90.15337773 195.30216753 90.16113281 212.11547852 C90.16577247 214.48773778 90.17079863 216.85999632 90.17617798 219.23225403 C90.18917964 225.62001817 90.19572085 232.00777188 90.20018864 238.39554715 C90.20313477 242.39216242 90.20721132 246.38877558 90.21169281 250.38538933 C90.22385446 261.48049167 90.23416702 272.57559217 90.2375679 283.67070103 C90.23778747 284.37696672 90.23800703 285.08323241 90.23823325 285.81090009 C90.23845153 286.51867257 90.23866981 287.22644504 90.2388947 287.95566517 C90.23933814 289.38947014 90.23978471 290.82327511 90.24023438 292.25708008 C90.2404558 292.96826903 90.24067723 293.67945799 90.24090537 294.41219812 C90.24486392 305.96715195 90.26236387 317.52204315 90.2855939 329.07697273 C90.30932439 340.97774912 90.32177014 352.87849401 90.32293582 364.77929443 C90.32385042 371.4466227 90.32987305 378.11387982 90.34775543 384.78119087 C90.36422538 391.04156213 90.36639678 397.3017772 90.35761642 403.5621624 C90.35684592 405.85629571 90.36119053 408.15043741 90.37107468 410.44454956 C90.3837925 413.58041139 90.37791835 416.71571951 90.36749268 419.85157776 C90.37957728 421.2062514 90.37957728 421.2062514 90.39190602 422.58829218 C90.33546583 429.86659955 89.33366617 436.38851643 84.375 441.9375 C79.17121691 445.11758967 74.73136304 446.57228655 68.6839447 445.3052063 C64.5733145 443.8488271 62.66167098 442.26805357 59.61547852 439.18310547 C59.1267778 438.69513489 58.63807709 438.20716431 58.13456726 437.70440674 C56.53719085 436.10357287 54.95821953 434.48582711 53.37890625 432.8671875 C52.26899683 431.74794343 51.15797144 430.62980501 50.04588318 429.51272583 C47.13311436 426.58093884 44.23567934 423.63444715 41.34124756 420.68457031 C38.38054355 417.6725622 35.40549321 414.67479799 32.43164062 411.67578125 C26.60700799 405.79765241 20.79850713 399.90390151 15 394 C9.01387353 398.935494 3.63484021 404.33040571 -1.7734375 409.88671875 C-3.66851078 411.81390753 -5.56433654 413.74033265 -7.4609375 415.66601562 C-10.42695598 418.67987162 -13.38814875 421.69809103 -16.33398438 424.73168945 C-18.26679971 426.72139907 -20.20749907 428.70274286 -22.15762329 430.67549133 C-23.9851236 432.524448 -25.80117512 434.38481279 -27.60385132 436.25798035 C-33.10967052 441.78799463 -38.11407689 445.89241208 -46.19296265 446.04008484 C-51.16818219 445.39708562 -54.03458348 443.36076131 -57.67724609 439.99243164 C-58.55282166 439.1828299 -59.42839722 438.37322815 -60.33050537 437.53909302 C-64.52793366 433.54670407 -68.64331548 429.47993755 -72.7265625 425.37109375 C-73.60025482 424.49598648 -74.47394714 423.62087921 -75.37411499 422.71925354 C-78.1267957 419.96103631 -80.87595325 417.19933863 -83.625 414.4375 C-85.5059904 412.55091287 -87.38778499 410.66513033 -89.26953125 408.77929688 C-93.84902698 404.1888565 -98.42564613 399.59556394 -103 395 C-106.55172865 396.5100768 -108.80632061 398.57455035 -111.50561523 401.31030273 C-112.39010849 402.20140244 -113.27460175 403.09250214 -114.18589783 404.01060486 C-114.65384199 404.48678694 -115.12178616 404.96296902 -115.60391045 405.45358086 C-117.07527197 406.95056238 -118.55287248 408.44112525 -120.03224182 409.93019104 C-123.70517886 413.62981533 -127.36718528 417.34019912 -131.02954102 421.05029297 C-134.12616519 424.18645865 -137.22690316 427.3184464 -140.33317757 430.44505501 C-141.78467677 431.90946405 -143.22998948 433.37979339 -144.67515564 434.85044861 C-145.56280106 435.74470047 -146.45044647 436.63895233 -147.36499023 437.56030273 C-148.14124252 438.34702866 -148.91749481 439.13375458 -149.7172699 439.94432068 C-154.19811098 443.97947681 -157.94308344 445.68671121 -164 446 C-174.9234452 444.76338356 -183.37458192 432.76916191 -190.7265625 425.37109375 C-191.60025482 424.49598648 -192.47394714 423.62087921 -193.37411499 422.71925354 C-196.1267957 419.96103631 -198.87595325 417.19933863 -201.625 414.4375 C-203.5059904 412.55091287 -205.38778499 410.66513033 -207.26953125 408.77929688 C-211.84902698 404.1888565 -216.42564613 399.59556394 -221 395 C-224.55172865 396.5100768 -226.80632061 398.57455035 -229.50561523 401.31030273 C-230.83235512 402.64695229 -230.83235512 402.64695229 -232.18589783 404.01060486 C-232.65384199 404.48678694 -233.12178616 404.96296902 -233.60391045 405.45358086 C-235.07527197 406.95056238 -236.55287248 408.44112525 -238.03224182 409.93019104 C-241.70517886 413.62981533 -245.36718528 417.34019912 -249.02954102 421.05029297 C-252.12616519 424.18645865 -255.22690316 427.3184464 -258.33317757 430.44505501 C-259.78467677 431.90946405 -261.22998948 433.37979339 -262.67515564 434.85044861 C-263.56280106 435.74470047 -264.45044647 436.63895233 -265.36499023 437.56030273 C-266.14124252 438.34702866 -266.91749481 439.13375458 -267.7172699 439.94432068 C-272.17362465 443.957426 -275.95783738 445.79859458 -282 446 C-291.06605774 444.79143635 -296.55642646 438.21573887 -302.59765625 431.98828125 C-303.6820626 430.89266618 -304.7678148 429.79838172 -305.85484314 428.70536804 C-308.6942733 425.84317175 -311.5152098 422.96341794 -314.33251953 420.07946777 C-317.21776959 417.13253053 -320.12035975 414.20278018 -323.02148438 411.27148438 C-328.69798271 405.53088934 -334.35503606 399.77160626 -340 394 C-346.00760204 398.96373154 -351.45135737 404.36960109 -356.9140625 409.921875 C-357.85570305 410.87302194 -358.79779937 411.82371785 -359.74032593 412.77398682 C-363.71180431 416.77879074 -367.67883401 420.78792492 -371.63574219 424.80712891 C-374.06881099 427.27790257 -376.50918677 429.74125488 -378.95435715 432.20005035 C-380.32742112 433.58502422 -381.6923108 434.97808674 -383.05703735 436.37127686 C-384.31391861 437.63333954 -384.31391861 437.63333954 -385.59619141 438.92089844 C-386.3278653 439.66225037 -387.05953918 440.40360229 -387.81338501 441.16741943 C-392.15251172 444.80399895 -396.3083325 445.39566724 -401.7890625 445.25 C-406.29862137 444.74008522 -409.09824943 442.90175057 -412.25 439.75 C-416.20985005 433.52737849 -416.28937115 427.31817026 -416.25396729 420.15937805 C-416.25864726 418.69771085 -416.25864726 418.69771085 -416.26342177 417.20651501 C-416.27138277 413.9492195 -416.26508501 410.69211128 -416.25878906 407.43481445 C-416.26150013 405.0950052 -416.26506172 402.7551968 -416.26940918 400.41539001 C-416.27853215 394.05873407 -416.27498646 387.70214302 -416.26865101 381.34548593 C-416.26409294 375.34709885 -416.26757788 369.34871765 -416.2705054 363.35033073 C-416.2762088 350.7194058 -416.26965549 338.08850988 -416.25890467 325.45758971 C-416.25001256 314.67882442 -416.25148509 303.90010235 -416.26074219 293.12133789 C-416.27152012 280.56613826 -416.27561399 268.01096427 -416.26951766 255.45576066 C-416.26888069 254.10785338 -416.26825195 252.75994609 -416.26763153 251.4120388 C-416.26732298 250.74912897 -416.26701443 250.08621914 -416.26669653 249.40322113 C-416.26498869 244.79010691 -416.26794429 240.17700987 -416.27259064 235.56389809 C-416.34299995 154.21085363 -404.68795967 79.93380565 -346 19 C-345.36787598 18.34064453 -344.73575195 17.68128906 -344.08447266 17.00195312 C-334.9383418 7.51195024 -325.63763192 -1.21711719 -315 -9 C-313.87216154 -9.84604192 -312.74455819 -10.69239736 -311.6171875 -11.5390625 C-235.19397067 -68.2091448 -131.37622629 -74.37382751 0 0 Z M-292.3359375 127.10546875 C-304.12212429 140.52401475 -307.85710213 154.27417697 -307.18359375 171.67089844 C-306.77642687 176.83628678 -305.16191027 181.3348252 -303 186 C-302.649375 186.78375 -302.29875 187.5675 -301.9375 188.375 C-295.68061094 200.88877812 -285.12608512 209.459391 -272.1875 214.375 C-259.21047645 218.65193452 -246.79800204 217.71650506 -234 213 C-230.07413739 210.96971321 -226.53526196 208.64543412 -223 206 C-222.40703125 205.5771875 -221.8140625 205.154375 -221.203125 204.71875 C-212.21433427 197.86132202 -205.17284186 185.60371405 -203.25 174.52734375 C-201.74553672 159.31816025 -204.22394474 145.72906291 -213 133 C-223.00893509 120.82842 -235.78948323 113.83685909 -251.375 112.1875 C-266.2891412 111.4217798 -281.47077927 116.50356326 -292.3359375 127.10546875 Z M-112 132.12109375 C-121.76492957 143.59067698 -123.79713003 157.45975772 -123 172 C-120.86784391 185.89515281 -113.65962148 198.16193963 -102.47875977 206.55395508 C-90.45788234 215.18256731 -76.65507418 218.77457904 -61.97265625 216.5390625 C-48.34373701 213.49449447 -36.56728089 206.79278356 -28.12109375 195.484375 C-19.58437729 181.87697734 -16.65000527 167.26025823 -19.68359375 151.43359375 C-24.48221657 136.16162819 -33.80224843 125.21368645 -47.66796875 117.51953125 C-71.0277812 106.02502036 -94.90060772 113.98638671 -112 132.12109375 Z " fill="${color}" transform="translate(419,63)"/>`;
}
function ghostLeftEye(color) {
  return `<path xmlns="http://www.w3.org/2000/svg" d="M0 0 C5.19256117 2.94355378 8.32237176 6.59314094 10.6875 12.0625 C12.54877625 18.79905098 11.85543902 24.85333953 8.6875 31.0625 C5.9586185 35.30834282 2.75713769 38.89331135 -2.1328125 40.62109375 C-8.75763011 41.96267868 -15.82838809 42.45756583 -21.8125 38.9375 C-27.06068995 35.0068936 -30.89747885 30.62305262 -32.3125 24.0625 C-33.1413179 17.32994845 -31.9988472 11.79681786 -28.3125 6.0625 C-20.71116365 -2.36741804 -10.50317268 -4.60108773 0 0 Z " fill="${color}" transform="translate(174.3125,207.9375)"/>`;
}
function ghostRightEye(color) {
  return `<path xmlns="http://www.w3.org/2000/svg" d="M0 0 C4.98392526 3.71885889 8.54989735 8.15573674 9.78515625 14.33203125 C10.40532953 20.37590174 10.02781234 26.06672829 6.78515625 31.33203125 C2.58501056 35.86212469 -1.87076659 39.95162036 -8.16796875 40.66796875 C-17.09258144 40.77371061 -22.52468265 39.85818519 -29.02734375 33.64453125 C-33.05538294 27.54492904 -34.984996 21.8451668 -33.78515625 14.53125 C-32.01873527 7.71964035 -29.01937091 3.27910972 -23.21484375 -0.66796875 C-16.01436952 -4.18447942 -6.93470308 -4.02981719 0 0 Z " fill="${color}" transform="translate(360.21484375,208.66796875)"/>`;
}

function pacmanBody() {
  return `<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="16" height="16" viewBox="0 0 512 512">
<path d="M0 0 C62.95741102 -1.11676117 121.22724616 23.32435023 167.5234375 65.125 C168.87093663 66.44401541 170.21112314 67.77097394 171.5234375 69.125 C170.24268088 71.93335357 168.91294352 73.98494023 166.73171043 76.16282272 C166.15993486 76.7385804 165.58815928 77.31433807 164.99905717 77.90754294 C164.37065828 78.53011615 163.7422594 79.15268936 163.09481812 79.79412842 C162.42749023 80.46316515 161.76016235 81.13220189 161.0726124 81.82151246 C158.83096895 84.06645523 156.58224246 86.30416606 154.33349609 88.54199219 C152.72688069 90.14804358 151.1207053 91.75453524 149.51493835 93.36143494 C145.14982894 97.72711923 140.77857129 102.08660057 136.40620756 106.44501781 C131.8395557 110.99918494 127.27854994 115.55899936 122.71694946 120.1182251 C115.05832864 127.7713318 107.39622577 135.42093396 99.73144531 143.06787109 C91.83684954 150.94410764 83.94435797 158.82244291 76.0546875 166.70361328 C75.56833267 167.18944267 75.08197784 167.67527205 74.58088498 168.17582354 C72.14098824 170.61311019 69.70113282 173.0504382 67.26129794 175.48778677 C47.02174621 195.70660652 26.77488415 215.91809477 6.5234375 236.125 C7.80419412 238.93335357 9.13393148 240.98494023 11.31516457 243.16282272 C11.88694014 243.7385804 12.45871572 244.31433807 13.04781783 244.90754294 C13.67621672 245.53011615 14.3046156 246.15268936 14.95205688 246.79412842 C15.61938477 247.46316515 16.28671265 248.13220189 16.9742626 248.82151246 C19.21590605 251.06645523 21.46463254 253.30416606 23.71337891 255.54199219 C25.31999431 257.14804358 26.9261697 258.75453524 28.53193665 260.36143494 C32.89704606 264.72711923 37.26830371 269.08660057 41.64066744 273.44501781 C46.2073193 277.99918494 50.76832506 282.55899936 55.32992554 287.1182251 C62.98854636 294.7713318 70.65064923 302.42093396 78.31542969 310.06787109 C86.21002546 317.94410764 94.10251703 325.82244291 101.9921875 333.70361328 C102.47854233 334.18944267 102.96489716 334.67527205 103.46599002 335.17582354 C105.90588676 337.61311019 108.34574218 340.0504382 110.78557706 342.48778677 C131.02512879 362.70660652 151.27199085 382.91809477 171.5234375 403.125 C169.63371029 407.24794109 166.88545137 409.96052593 163.5859375 413 C162.97548584 413.56299805 162.36503418 414.12599609 161.73608398 414.70605469 C149.50920834 425.73594674 135.90137171 435.13567075 121.5234375 443.125 C120.82347656 443.52138672 120.12351562 443.91777344 119.40234375 444.32617188 C66.09281904 474.35376884 1.51217387 481.9686031 -57.51513672 466.05834961 C-88.10405771 457.44552439 -116.59423109 444.09781311 -141.4765625 424.125 C-142.36988281 423.42246094 -143.26320313 422.71992188 -144.18359375 421.99609375 C-170.37867986 401.04751988 -190.85868808 375.77272448 -206.4765625 346.125 C-206.84104492 345.44083008 -207.20552734 344.75666016 -207.58105469 344.05175781 C-219.32286127 321.6977624 -226.6086491 297.00605398 -230.4765625 272.125 C-230.60498535 271.33254883 -230.7334082 270.54009766 -230.86572266 269.72363281 C-239.97774235 211.07536059 -223.72547647 147.03684766 -189.07910156 99.1953125 C-186.00775842 95.06240505 -182.7790135 91.07445248 -179.4765625 87.125 C-178.74155518 86.23772217 -178.74155518 86.23772217 -177.99169922 85.33251953 C-169.19485553 74.74294074 -160.03882076 64.93329772 -149.23828125 56.33203125 C-147.44647573 54.90010746 -145.67640837 53.44038272 -143.93359375 51.94921875 C-104.08806563 18.01119707 -51.61902233 1.85596485 0 0 Z M-76.80078125 118.05859375 C-84.17424081 127.15080846 -85.29859101 136.77375332 -84.4765625 148.125 C-82.50944602 158.37261358 -76.05238644 165.75620391 -67.9765625 172.0625 C-59.00444379 177.8259111 -48.84417355 178.56774368 -38.484375 176.5390625 C-28.82474833 173.55634492 -20.26795079 166.04555218 -15.4765625 157.125 C-11.19033469 148.30861272 -11.05822217 138.39196696 -14.2265625 129.1875 C-18.72823768 118.34897195 -25.19934517 111.65218477 -35.92578125 107.0703125 C-51.02216899 101.47563282 -65.91138476 106.87945722 -76.80078125 118.05859375 Z " fill="#ECC24D" transform="translate(286.4765625,18.875)"/>
</svg>`;
}

// Random Color
const usedColors = new Set();
function getRandomColor() {
  let color;
  do {
    // Generate light colors by constraining the range to high values (C-F)
    color = "#";
    for (let i = 0; i < 6; i++) {
      const lightLetters = "A4BF"; // Light color range
      color += lightLetters[Math.floor(Math.random() * lightLetters.length)];
    }
  } while (usedColors.has(color)); // Ensure no repetition

  usedColors.add(color); // Store the color to prevent reuse
  return color;
}

// Start Game
window.addEventListener("load", (event) => {
  setMap();
});
